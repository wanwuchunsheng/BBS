<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>海伦社区</title>
<meta name="keywords" content="海伦国际 ，海伦社区，社区，BBS，bbs，海伦BBS，武汉，武汉青山，武汉武东， 武东区，青山武东，青山武东社区，青山海伦国际论坛 BBS，青山BBS，BBS社区，武汉BBS社区，武汉社区，武汉BBS，青山海伦，青山海伦国际社区 "/>
<meta name="description" content="武汉青山武东海伦国际业主自己开发的社区，方便业主近距离交流，分享生活。青山武东海伦国际自己的交流区，海伦国际欢迎各业主加入QQ【总】群:645952730"/>
<meta name="author" content="注册页" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />


<script type="text/jscript" src="${resRoot}/view/js/jquery-1.8.2.min.js" ></script>
<script type="text/jscript" src="${resRoot}/view/js/common.js"></script>

<!-- icon-font -->
<link rel="stylesheet" href="${resRoot}/view/css/font-awesome.min.css" />
<!--[if IE 7]>
<link href="${resRoot}/view/css/font-awesome-ie7.min.css" rel="stylesheet" type="text/css" />
<![endif]-->

<!-- layui 2.0 -->
<link rel="stylesheet" href="${resRoot}/view/css/layui.css" />
<!-- 自定义 -->
<link rel="stylesheet" href="${resRoot}/view/css/global.css" />
<link rel="stylesheet"  data-href="${resRoot}/view/css/stretch.css" class="fly-style" />
<link rel="stylesheet" href="${resRoot}/view/css/style.css" />
<link rel="stylesheet" href="${resRoot}/view/css/common.css" />
<link rel="shortcut icon" href="${resultImgPath}/bbs/bbs_icon/favicon.ico" />

</head>

<body>
<!-- heand -->
<div class="header">
  <div class="main">
		<a class="logo"  href="#" title="海伦社区">
		  <img class="logo-img" src="${resultImgPath}/bbs/bbs_icon/logo.png"  />
		</a>
       
		<div class="nav" >
			<ul>
			<li>
			<a href="${futRoot}/view/index">
				<i class="iconfont icon-desktop"></i>首页
			</a>
			</li>
			
			<li>
			<a href="${futRoot}/cont/index"  >
				<i class="iconfont  icon-leaf"></i>综合区
			</a>
			</li>
            <li>
			<a href="${futRoot}/que/index" class="">
				<i class="iconfont icon-tags"></i>反馈
			</a>
			</li>
			<li class="newMsg">
			<a href="${futRoot}/mine/index" class="layui-hide nav-this">
				<i class="iconfont icon-user"></i>我的
			</a>
            </li>
            
			</ul>
		</div>
        
		<div class="nav-user unlogin">
		  <#if (bbsUserInfo)?? >
		     <div class="loginuser-span">
			     <a href="${futRoot}/mine/index">
			         <img class="fly-list-avatar-img loginuser-img" src="${resultImgPath}/bbs/bbs_icon/${bbsUserInfo.photoPath?if_exists}" />
			     </a>
			     <span class="loginuser-signin"> 
			        <a>${bbsUserInfo.niceName?if_exists}</a>
			     </span>
			     <span class="loginuser-signin"> 
			        <a  href="${futRoot}/mine/logout"><i class="iconfont icon-signin"></i>  注销</a>
			     </span>
		     </div>
		  <#else>
			   <span>
					<a href="${futRoot}/mine/login">登入</a>
					<a href="${futRoot}/mine/reg">注册</a>
				</span> 
				<p class="out-login">
				    <a href="#" class="iconfont icon-comments" title="微信登录"></a>
					<a href="#" class="iconfont icon-weibo" title="微博登录"></a>
				</p>
		  </#if>
		</div>		
  </div>
</div>
<!-- heand end -->

<!-- content -->
<div class="main layui-clear">
<div class="fly-panel fly-panel-user" pad20>
	<div class="layui-tab layui-tab-brief" lay-filter="user">
		<ul class="layui-tab-title">
			<li>
				<a href="${futRoot}/mine/login">登入</a>
			</li>
			<li class="layui-this">注册</li>
		</ul>
		<div class="layui-form layui-tab-content" id="LAY_ucm" style="padding: 20px 0;">
			<div class="layui-tab-item layui-show">
				<div class="layui-form layui-form-pane">
					<form id="addUserInfo" method="post" action="" >
						<input type="hidden" name="redirectURL" value="" />
						<input type="hidden" id="flags" name="flags" value="1" />
						<input type="hidden" name="bind" value="" />
						<div class="layui-form-item">
							<label for="L_email" class="layui-form-label">邮箱</label>
							<div class="layui-input-inline">
								<input type="text" name="email" required lay-verify="email" autocomplete="off" class="layui-input" placeholder="邮箱可以登录社区"/>
							</div>
						</div>
						
						<div class="layui-form-item">
							<label for="L_username" class="layui-form-label">验证邮箱</label>
							<div class="layui-input-inline">
								<input type="text" id="checkcode" name="checkcode" required lay-verify="required" autocomplete="off" class="layui-input" placeholder="区分大小写" style="width:106px;"/>
							</div>
							<div class="layui-form-checkcode">
							     <input type="button" class="layui-btn layui-btn-sm layui-bg-blue layui-btn-radius" style="margin-top:3px;" id="btn" value="获取验证码"  /> 
							</div>
						</div>
						
						<div class="layui-form-item">
							<label for="L_username" class="layui-form-label">用户名</label>
							<div class="layui-input-inline">
								<input type="text"  name="uname" required lay-verify="uname" autocomplete="off" class="layui-input" placeholder="用户名"/>
							</div>
						</div>
						<div class="layui-form-item">
							<label for="L_pass" class="layui-form-label">密码</label>
							<div class="layui-input-inline">
								<input type="password" name="upwd" required lay-verify="upwd" autocomplete="off" class="layui-input" placeholder="6到16个字符"/>
							</div>
						</div>
						<div class="layui-form-item">
							<label for="L_repass" class="layui-form-label">确认密码</label>
							<div class="layui-input-inline">
								<input type="password"  name="twoupwd" required lay-verify="twoupwd" autocomplete="off" class="layui-input" placeholder="请再次输入密码"/>
							</div>
						</div>
						<div class="layui-form-item">
							<label for="L_vercode" class="layui-form-label">验证码</label>
							<div class="layui-input-inline">
								<input type="text"  id="imageContent" name="imageContent" required lay-verify="imageContent" placeholder="请输入后面的数字" autocomplete="off" class="layui-input">
							</div>
							
							<span class="check-code">
								<img id="imgObj" alt="验证码"  src="${futRoot}/captcha/getCaptchaImage.jpg"  onclick="changeImg()">
							</span>
						</div>
						<input type="hidden" id="emailCode" name="emailCode"   value=""  />
						<input type="hidden" id="emailName" name="emailName"   value=""  />
						<div class="layui-form-item">
							<button class="layui-btn layui-btn-normal" lay-filter="demoSub" lay-submit>立即注册</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
</div>
</div>

<!-- footer -->
<div class="footer">
	<p>
		Copyright @ 2018<a href="http://www.cloudyf.cn" id="Cooperation"> 云朵家技术团队</a> 版权所有
		<a class="display" target="_blank" href="#"><img src="${resultImgPath}/bbs/bbs_icon/ga.png"/>鄂ICP备18018426号-1</a>
	</p>
</div>
<!-- footer end -->

<!-- layui 2.0 -->
<script src="${resRoot}/view/js/layui.all.js" ></script>

<script type="text/javascript">
var layer;
layui.use(['form'], function(){
	var form = layui.form;
	 layer = layui.layer;
	 
	  form.verify({ 
		uname: function(value){  
          if(value.length > 8 || value.length < 2){  
			 return '请输入2到8位字符';  
		  }
        },upwd: function(value){  
	          if(value.length > 12 || value.length < 6){  
				 return '请输入6到16位字符';  
			  }
        },twoupwd: function(value){ 
			  if(value.length > 12 || value.length < 6){  
				 return '请输入6到16位字符';  
			  }
        },imageContent: function(value){ 
			  if(value.length!=4){  
					 return '验证码4位';  
			  }
        }
     }); 
	//监听提交
	form.on('submit(demoSub)', function(data){
		var upwd=data.field.upwd;
	    var twoupwd=data.field.twoupwd;
	    var emailName=data.field.email;
	    var emailName2=$("input[name='emailName']").val();
	    if(emailName2!=emailName){
	    	layer.msg('验证邮箱与提交邮箱不一致.', {icon: 2});
		 	return false;
		}
		//邮箱证码
	    var checkCode=data.field.checkcode;
	    var emailCode=$("input[name='emailCode']").val();
	    console.info("1="+checkCode+"/"+emailCode);
	    if(checkCode!=emailCode){
	    	 layer.msg('邮箱验证码错误.', {icon: 2});
	 		 return false;
		}
	    //验证密码
	    if(upwd!=twoupwd){
	      layer.msg('确认密码不一致', {icon: 2});
		  return false;
	    }
	    
	    //验证码验证
	    var imageContent=data.field.imageContent;
	    var res=false;
	    $.ajax({
		    type : 'post',
		    async : false,
		    url :'${futRoot}/captcha/checkCaptcha',
		    data : {
		        "code" : imageContent
		    },
		    success : function(data) {
			    console.info("验证码返回："+data)
		       if(data=='false'){
		    	   res=false;
			   }else{
                   res=true;
				}  
		    }
		});
		if(!res){
			layer.msg('验证码输入错误', {icon: 2});
			 return false;
		}
		//ajax提交
		var res2=false;
	    $.ajax({
	    	url :'${futRoot}/mine/saveReg',
		    type : "post",
			dataType : "json",
		    async: false,
			data : $("#addUserInfo").serialize(),
		    success : function(data) {
			   console.info("验证码返回："+data)
		       if(data=='1'){
		    	   window.location.href="${futRoot}/mine/login";
			   }else if(data=='2'){
				   layer.msg('邮箱已被注册', {icon: 2});
				   res=false;
			   }else{
				   layer.msg('提交失败', {icon: 2});
				   res=false;
			   } 
		    }
		});
	    if(!res2){
			return false;
		}
	})
	return false;  
})
$(function(){
	//获取邮箱验证码
	$('#btn').click(function () {
		var email=$("input[name='email']").val();
		var filter = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
	    if (!filter.test(email)) {
		    layer.msg('邮箱不正确!', {icon: 2});
            return false;
		}
		console.info(email+"========");
		
		var count = 15;
		var countdown = setInterval(CountDown, 1000);
		function CountDown() {
			$("#btn").attr("disabled", true);
			$("#btn").val("重新发送(" + count + ")");
			if (count == 0) {
				$("#btn").val("获取验证码").removeAttr("disabled");
				clearInterval(countdown);
			}
		    count--;
		}
        //发送验证码
		$.ajax({
		    type : 'post',
		    async : true,
		    url :'${futRoot}/captcha/checkEmail',
		    data : {
		        "email" : email
		    },
		    success : function(data) {
			    console.info("邮箱验证码="+data)
		        $("#emailCode").val(data);
			    $("#emailName").val(email);
		    }
		});
	})
})

//单机刷新验证码
function changeImg() {
     var imgSrc = $("#imgObj");
     var src = imgSrc.attr("src");
     imgSrc.attr("src", chgUrl(src));
 };
//时间戳   
 //为了使每次生成图片不一致，即不让浏览器读缓存，所以需要加上时间戳   
 function chgUrl(url) {
     var timestamp = (new Date()).valueOf();
     var stamp = $("#timestamp");
     return url;
 };

 
</script>

</body>
</html>